# 策略框架

## 必须函数

### 初始化函数

```
initialize(context)

初始化方法，在整个回测、模拟实盘中最开始执行一次，用于初始一些全局变量
```

## 可选函数

### 定时运行策略

```
run_daily/run_weekly/run_monthly

run_monthly(func, monthday, time='9:30', reference_security, force=False)
```

### 运行策略

```
handle_data(context, data)

该函数每个单位时间会调用一次, 如果按天回测,则每天调用一次,如果按分钟,则每分钟调用一次。
```

### 事件回调

```
on_event(context, event)

用户在策略中定义on_event，在账户中持仓的标的发生对应的事件时on_event会被调用。建议用户使用isinstance对事件类型进行判断。 目前已支持的事件有：

- DividendsEvent：分红送股事件
- ForcedLiquidationEvent：强行平仓事件
```

### 开盘前运行策略

```
before_trading_start(context)

该函数会在每天开始交易前被调用一次, 您可以在这里添加一些每天都要初始化的东西。
```

### 收盘后运行策略

```
after_trading_end(context)

该函数会在每天结束交易后被调用一次, 您可以在这里添加一些每天收盘后要执行的内容. 这个时候所有未完成的订单已经取消。
```

### 策略运行结束时调用

```
def on_strategy_end(context)

在回测、模拟交易正常结束时被调用， 失败时不会被调用。在模拟交易到期结束时也会被调用， 手动在到期前关闭不会被调用。
```

### 每次程序启动时运行函数

```
process_initialize(context)

该函数会在每次模拟盘/回测进程重启时执行, 一般用来初始化一些不能持久化保存的内容。在 initialize 后执行，因为模拟盘会每天重启, 所以这个函数会每天都执行。
```

### 模拟交易更换代码后运行函数

```
after_code_changed(context)

模拟盘在每天的交易时间结束后会休眠，第二天开盘时会恢复，如果在恢复时发现代码已经发生了修改，则会在恢复时执行这个函数。 具体的使用场景：可以利用这个函数修改一些模拟盘的数据。
```

### 取消所有定时运行

```
unschedule_all()
```
